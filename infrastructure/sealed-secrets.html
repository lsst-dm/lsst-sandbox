<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sealed Secrets &mdash; Kubernetes Sandbox  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Longhorn" href="longhorn.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Kubernetes Sandbox
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Apps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/landing-page.html">Landing Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="argocd.html">ArgoCD</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation system</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">Host node provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes (k3s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="longhorn.html">Longhorn</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sealed Secrets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-create-sealed-secrets">How to create sealed secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#master-key-backup">Master key backup</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kubernetes Sandbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Sealed Secrets</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/infrastructure/sealed-secrets.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sealed-secrets">
<h1>Sealed Secrets<a class="headerlink" href="#sealed-secrets" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://engineering.bitnami.com/articles/sealed-secrets.html">Overview of Sealed Secrets</a>:</p>
<blockquote>
<div><p>Sealed Secrets are a “one-way” encrypted Secret that can be created by anyone, but can only be decrypted by the controller running in the target cluster. The Sealed Secret is safe to share publicly, upload to git repositories, post to twitter, etc. Once the SealedSecret is safely uploaded to the target Kubernetes cluster, the sealed secrets controller will decrypt it and recover the original Secret.</p>
</div></blockquote>
<p>We chose Sealed Secrets over alternatives like Vault due to its simplicity. As long as an admin downloads the secret key, all secret file manipulation can be performed locally without access to the Kubernetes cluster. Additionally, secrets can be natively version-controlled within the GitOps deployment repo, which increases reproducibility when for example application configurations are stored as secrets.</p>
<section id="how-to-create-sealed-secrets">
<h2>How to create sealed secrets<a class="headerlink" href="#how-to-create-sealed-secrets" title="Permalink to this headline"></a></h2>
<p>We use a custom script to make generating sealed secrets more convenient. First, construct a YAML file <code class="docutils literal notranslate"><span class="pre">scripts/secret_generator/secrets/secrets.yaml</span></code> where secrets are specified in plaintext following this example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">secrets</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd-secret</span><span class="w"></span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">dex.gitlab.clientId: *****</span><span class="w"></span>
<span class="w">    </span><span class="no">dex.gitlab.clientSecret: *****</span><span class="w"></span>
<span class="w">    </span><span class="no">admin.password: *****</span><span class="w"></span>
<span class="w">    </span><span class="no">admin.passwordMtime: *****</span><span class="w"></span>
<span class="w">    </span><span class="no">server.secretkey: *****</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-read-api</span><span class="w"></span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">.dockerconfigjson: |</span><span class="w"></span>
<span class="w">      </span><span class="no">{</span><span class="w"></span>
<span class="w">        </span><span class="no">&quot;auths&quot;: {</span><span class="w"></span>
<span class="w">          </span><span class="no">&quot;registry.gitlab.com&quot;: {</span><span class="w"></span>
<span class="w">            </span><span class="no">&quot;auth&quot;: &quot;*****&quot;</span><span class="w"></span>
<span class="w">          </span><span class="no">}</span><span class="w"></span>
<span class="w">        </span><span class="no">}</span><span class="w"></span>
<span class="w">      </span><span class="no">}</span><span class="w"></span>
</pre></div>
</div>
<p>Run the Sealed Secret generator script</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> scripts/secret_generator
python3 seal_bulk_secrets.py --file secrets/secrets.yaml 
</pre></div>
</div>
<p>Copy the contents of the desired secret into the Helm chart <code class="docutils literal notranslate"><span class="pre">secrets.yaml</span></code> template file. For example, if the <code class="docutils literal notranslate"><span class="pre">keel</span></code> chart needs a secret <code class="docutils literal notranslate"><span class="pre">gitlab-read-api</span></code>, then append the YAML content of <code class="docutils literal notranslate"><span class="pre">scripts/secret_generator/sealed-secrets/sealed.gitlab-read-api.secret.yaml</span></code> to <code class="docutils literal notranslate"><span class="pre">charts/keel/templates/secrets.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami.com/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SealedSecret</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">sealedsecrets.bitnami.com/cluster-wide</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-read-api</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">encryptedData</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">.dockerconfigjson</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AgB...+pq1A=</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">sealedsecrets.bitnami.com/cluster-wide</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-read-api</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="master-key-backup">
<h2>Master key backup<a class="headerlink" href="#master-key-backup" title="Permalink to this headline"></a></h2>
<p>The master key required to decrypt the Sealed Secrets can be downloaded for backup purposes <a class="reference external" href="https://github.com/bitnami-labs/sealed-secrets#how-can-i-do-a-backup-of-my-sealedsecrets">following the documentation here</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl get secret -n sealed-secrets <span class="se">\</span>
    -l sealedsecrets.bitnami.com/sealed-secrets-key -o yaml <span class="se">\</span>
    &gt;&gt; sealed-secrets-master-key.yaml
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="longhorn.html" class="btn btn-neutral float-left" title="Longhorn" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>