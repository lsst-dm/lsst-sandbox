

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Vault &mdash; LSST Sandbox  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ArgoCD" href="../infrastructure/argocd.html" />
    <link rel="prev" title="Landing Page" href="landing-page.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> LSST Sandbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Apps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="landing-page.html">Landing Page</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vault</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-a-github-access-token">Create a GitHub access token</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-create-and-use-secrets">How to create and use secrets</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/argocd.html">ArgoCD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/documentation.html">Documentation system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/infrastructure.html">Host node provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/kubernetes.html">Kubernetes (k3s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/vault.html">Vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/vault-secrets-operator.html">Vault Secrets Operator (VSO)</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LSST Sandbox</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Vault</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/apps/vault.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vault">
<h1>Vault<a class="headerlink" href="#vault" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-a-github-access-token">
<h2>Create a GitHub access token<a class="headerlink" href="#create-a-github-access-token" title="Permalink to this headline">¶</a></h2>
<p>To login and access the Vault, <a class="reference external" href="https://github.com/settings/tokens/new">create a personal access token</a> in your GitHub user settings (you might label it “LSST Sandbox Vault”), selecting only scopes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read:org</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read:user</span></code></p></li>
</ul>
<p><em><strong>WARNING: You must keep your access token secure.</strong></em></p>
<p>Open the <a class="reference external" href="https://vault.lsst-sandbox.ncsa.illinois.edu/">Vault GUI</a>, select the GitHub sign in method, and enter your token.</p>
</div>
<div class="section" id="how-to-create-and-use-secrets">
<h2>How to create and use secrets<a class="headerlink" href="#how-to-create-and-use-secrets" title="Permalink to this headline">¶</a></h2>
<p>When you need to create a Kubernetes Secret resource for use in your apps, instead of defining a <code class="docutils literal notranslate"><span class="pre">Secret</span></code> resource directly, you define a <code class="docutils literal notranslate"><span class="pre">VaultSecret</span></code> resource like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">ricoberger</span><span class="o">.</span><span class="n">de</span><span class="o">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">VaultSecret</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">secret</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">path</span><span class="p">:</span> <span class="n">kv</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">dm</span><span class="o">/</span><span class="n">my</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">repo</span><span class="o">/</span><span class="n">my</span><span class="o">-</span><span class="n">secret</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">Opaque</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">VaultSecret</span></code> resource type is a custom resource definition (CRD) created by the Vault Secrets Operator (VSO) that is running on the cluster.</p>
<p>In this example, the repo in which this app Helm chart is defined is <code class="docutils literal notranslate"><span class="pre">https://github.com/lsst-dm/my-app-repo</span></code>, and, by convention, a secret named <code class="docutils literal notranslate"><span class="pre">my-secret</span></code> should be stored in Vault at the path <code class="docutils literal notranslate"><span class="pre">kv/lsst-dm/my-app-repo/my-secret</span></code>.</p>
<p>The next step is to create the secret in Vault. After logging into the <a class="reference external" href="https://vault.lsst-sandbox.ncsa.illinois.edu/">Vault GUI</a>, select <code class="docutils literal notranslate"><span class="pre">kv/</span></code> from the Secrets page and click “Create secret”. Enter the path <code class="docutils literal notranslate"><span class="pre">lsst-dm/my-app-repo/my-secret</span></code> and specify the key-value pairs that will populate the Kubernetes Secret resource that will be automatically created by your app via the VSO machinery. Click Save and you should see your app show Healthy and Synced in ArgoCD when the Secret is generated.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../infrastructure/argocd.html" class="btn btn-neutral float-right" title="ArgoCD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="landing-page.html" class="btn btn-neutral float-left" title="Landing Page" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>